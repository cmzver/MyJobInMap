# FieldWorker Docker Compose
# ==========================
# Запуск: docker-compose up -d
# Остановка: docker-compose down
# Логи: docker-compose logs -f
# Пересборка: docker-compose up -d --build

version: '3.8'

services:
  # ==========================================================================
  # FieldWorker API Server (FastAPI + SQLite)
  # ==========================================================================
  api:
    build:
      context: ./server
      dockerfile: Dockerfile
    container_name: fieldworker-api
    restart: unless-stopped
    volumes:
      - ./server/tasks.db:/app/tasks.db
      - ./server/firebase-service-account.json:/app/firebase-service-account.json:ro
      - ./portal/dist:/portal/dist:ro
    ports:
      - "8001:8001"


  # ==========================================================================
  # Telegram Bot (парсинг заявок из чата)
  # ==========================================================================
  telegram-bot:
    build:
      context: ./bot
      dockerfile: Dockerfile
    container_name: fieldworker-telegram
    restart: unless-stopped
    env_file:
      - ./bot/.env
    environment:
      - API_BASE_URL=http://api:8001
    depends_on:
      - api
