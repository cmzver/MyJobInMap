# FieldWorker Docker Compose
# ==========================
# Запуск: docker-compose up -d
# Остановка: docker-compose down
# Логи: docker-compose logs -f
# Пересборка: docker-compose up -d --build

version: '3.8'

services:
  # ==========================================================================
  # FieldWorker API Server (FastAPI + SQLite)
  # ==========================================================================
  api:
    build:
      context: ./server
      dockerfile: Dockerfile
    container_name: fieldworker-api
    restart: unless-stopped
    volumes:
      - ./server/fieldworker.db:/app/fieldworker.db
      - ./server/firebase-service-account.json:/app/firebase-service-account.json:ro
    ports:
      - "8001:8001"

  # ==========================================================================
  # PWA Web App (Nginx для статики)
  # ==========================================================================
  webapp:
    image: nginx:alpine
    container_name: fieldworker-webapp
    restart: unless-stopped
    volumes:
      - ./webapp:/usr/share/nginx/html:ro
      - ./webapp/nginx.conf:/etc/nginx/conf.d/default.conf:ro
    ports:
      - "8080:80"
    depends_on:
      - api

  # ==========================================================================
  # Telegram Bot (парсинг заявок из чата)
  # ==========================================================================
  telegram-bot:
    build:
      context: ./bot
      dockerfile: Dockerfile
    container_name: fieldworker-telegram
    restart: unless-stopped
    environment:
      - TELEGRAM_BOT_TOKEN=${TELEGRAM_BOT_TOKEN}
      - API_BASE_URL=http://api:8001
    depends_on:
      - api
